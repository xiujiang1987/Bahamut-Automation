/* minified */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const otplib_1=require("otplib"),_module_1=require("./_module"),login=new _module_1.Module;async function check2FA(t,a,e,o){if(await t.$("[name=twoStepAuth][required]")){if(o("æœ‰å•Ÿç”¨ 2FA"),!a.twofa)throw new Error("æœªæä¾› 2FA ç¨®å­ç¢¼");a=otplib_1.authenticator.generate(a.twofa);await t.type("[name=twoStepAuth]",a,{delay:10}).catch(e)}else o("æ²’æœ‰å•Ÿç”¨ 2FA")}login.parameters=[{name:"username",required:!0},{name:"password",required:!0},{name:"twofa",required:!1},{name:"login_max_attempts",required:!1}],login.run=async({page:a,params:e,logger:o})=>{var r=(...t)=>o.log("[95m[ç™»å…¥][m",...t),i=(...t)=>o.error("[95m[ç™»å…¥][m",...t);let w=!1;r("é–‹å§‹åŸ·è¡Œå¸³è™Ÿç™»å…¥ç¨‹åº"),await a.goto("https://www.gamer.com.tw/").catch(i),await a.waitForTimeout(1e3);var c=+e.login_max_attempts||3;for(let t=0;t<c;t++)try{if(r("æ­£åœ¨æª¢æ¸¬ç™»å…¥ç‹€æ…‹"),await a.goto("https://www.gamer.com.tw/"),await a.waitForSelector("#topBar_more"),await a.waitForTimeout(100),!await a.$("div.TOP-my.TOP-nologin")){r("ç™»å…¥ç‹€æ…‹: å·²ç™»å…¥"),w=!0;break}if(r("ç™»å…¥ç‹€æ…‹: æœªç™»å…¥"),await a.goto("https://user.gamer.com.tw/login.php").catch(i),r("å˜—è©¦ç™»å…¥ä¸­"),!e.username||!e.password)throw new Error("å¸³è™Ÿæˆ–å¯†ç¢¼ä¸èƒ½ç‚ºç©º");await a.$eval("input.form-control[type=text]",t=>t.value="").catch(i),await a.$eval("input.form-control[type=password]",t=>t.value="").catch(i),await a.type("input.form-control[type=text]",e.username,{delay:101}).catch(i),await a.waitForTimeout(500),await a.type("input.form-control[type=password]",e.password,{delay:101}).catch(i),await a.waitForTimeout(1e3),await check2FA(a,e,i,r),await a.waitForTimeout(500),await a.click("a#btn-login").catch(i),await a.waitForTimeout(3e3),0<t&&r("å·²å˜—è©¦ç™»å…¥ï¼Œé‡æ–°æª¢æ¸¬ç™»å…¥ç‹€æ…‹")}catch(t){i(t),i("ç™»å…¥æ™‚ç™¼ç”ŸéŒ¯èª¤ï¼Œé‡æ–°å˜—è©¦ä¸­")}return r("å¸³è™Ÿç™»å…¥ç¨‹åºå·²å®Œæˆ"),{success:w}},exports.default=login;