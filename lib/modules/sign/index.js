/* minified */
"use strict";var __importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0});const countapi_js_1=__importDefault(require("countapi-js")),_module_1=require("../_module"),sign=new _module_1.Module;async function sign_status(t){t=(await t.evaluate(async()=>{const t=new AbortController;setTimeout(()=>t.abort(),3e4);const a=await fetch("https://www.gamer.com.tw/ajax/signin.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"action=2",signal:t.signal});return a.json()})).data;return t}function report({days:t,signed:a,doubled:i}){let e=`# ç°½åˆ°

`;return e+=`âœ¨âœ¨âœ¨ å·²é€£çºŒç°½åˆ° ${t} å¤© âœ¨âœ¨âœ¨
`,e+=a?`ğŸŸ¢ ä»Šæ—¥å·²ç°½åˆ°
`:`âŒ ä»Šæ—¥å°šæœªç°½åˆ°
`,e+=i?`ğŸŸ¢ å·²ç²å¾—é›™å€ç°½åˆ°çå‹µ
`:`âŒ å°šæœªç²å¾—é›™å€ç°½åˆ°çå‹µ
`,e+="\n",e}sign.parameters=[{name:"sign_double_max_attempts",required:!1}],sign.run=async({page:t,outputs:i,params:a,logger:e})=>{var o=(...t)=>e.log("[95m[ç°½åˆ°][m",...t),r=(...t)=>e.error("[95m[ç°½åˆ°][m",...t);if(!i.login||!i.login.success)throw new Error("ä½¿ç”¨è€…æœªç™»å…¥ï¼Œç„¡æ³•ç°½åˆ°");o("é–‹å§‹åŸ·è¡Œ"),await t.goto("https://www.gamer.com.tw/"),await t.waitForTimeout(2e3);let{days:n,finishedAd:s,signin:u}=await sign_status(t);var m=u;if(o("å·²é€£çºŒç°½åˆ°å¤©æ•¸: "+n),u?o("ä»Šæ—¥å·²ç°½åˆ° [92mâœ”[m"):(o("ä»Šæ—¥å°šæœªç°½åˆ° [91mâœ˜[m"),o("æ­£åœ¨å˜—è©¦ç°½åˆ°"),await t.click("a#signin-btn").catch(r),await t.waitForTimeout(5e3),o("æˆåŠŸç°½åˆ° [92mâœ”[m")),i.ad_handler){var w=+a.sign_double_max_attempts||3;for(let a=0;a<w;a++)try{if(o("æ­£åœ¨æª¢æ¸¬é›™å€ç°½åˆ°çå‹µç‹€æ…‹"),await t.goto("https://www.gamer.com.tw/"),await t.waitForSelector("a#signin-btn"),await t.waitForTimeout(100),await t.click("a#signin-btn"),await t.waitForSelector("a.popoup-ctrl-btn"),await t.waitForTimeout(100),s){o("å·²ç²å¾—é›™å€ç°½åˆ°çå‹µ [92mâœ”[m");break}{o("å°šæœªç²å¾—é›™å€ç°½åˆ°çå‹µ [91mâœ˜[m"),o("å˜—è©¦è§€çœ‹å»£å‘Šä»¥ç²å¾—é›™å€çå‹µï¼Œå¯èƒ½éœ€è¦å¤šé” 1 åˆ†é˜"),await t.click("a.popoup-ctrl-btn"),await t.waitForSelector("button[type=submit]"),await t.waitForTimeout(100),await t.click("button[type=submit]"),await t.waitForTimeout(3e3),await t.waitForSelector("ins iframe");const c=await t.$("ins iframe");var l=await c.contentFrame();if(await i.ad_handler({ad_frame:l}),s=(await sign_status(t)).finishedAd,s){o("å·²è§€çœ‹é›™å€çå‹µå»£å‘Š [92mâœ”[m");break}throw new Error("è§€çœ‹é›™å€çå‹µå»£å‘Šéç¨‹ç™¼ç”ŸæœªçŸ¥éŒ¯èª¤")}}catch(t){r(t),r(`è§€çœ‹é›™å€çå‹µå»£å‘Šéç¨‹ç™¼ç”ŸéŒ¯èª¤ï¼Œå°‡å†é‡è©¦ ${w-a-1} æ¬¡ [91mâœ˜[m`)}}else e.warn("[95m[ç°½åˆ°][m","é›™å€ç°½åˆ°çå‹µéœ€ä½¿ç”¨ ad_handler æ¨¡çµ„");a=await sign_status(t);return o("åŸ·è¡Œå®Œç•¢ âœ¨"),!m&&a.signin&&countapi_js_1.default.update("Bahamut-Automation","sign",1),{signed:!!a.signin,doubled:!!a.finishedAd,days:a.days,report:report}},exports.default=sign;